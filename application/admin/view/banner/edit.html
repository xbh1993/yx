{extend name='public/modal'}
{block name='content'}
<style type="text/css">
    .pagination > .active > a, .pagination > .active > a:focus, .pagination > .active > a:hover, .pagination > .active > span, .pagination > .active > span:focus, .pagination > .active > span:hover {
        background-color: green
    }

    .divs {
        float: left;
        margin-left: 10px;
        margin-top: 5px;
        cursor: pointer;
        border: 5px solid white;
    }

    .divs span {
        display: block;
        background-color: black;
        color: white;
        position: relative;
        /*top:-20px;*/
        line-height: 20px;
        height: 20px;
        text-align: center;
        opacity: 0.7;
        cursor: pointer;
    }

    .current {
        border: 5px solid red;
    }
</style>

<form id="mainForm" class="layui-form layui-form-line layui-form-pane" method='post' action='editbanner'>

    <input type="hidden" value="{$info['id']}" name="id">
    <div class="layui-form-item">

        <div class="layui-form-item">
            <label class="layui-form-label">图片描述</label>
            <div class="layui-input-block">
                <textarea id="describle" class="layui-textarea" onchange="changedescrible(this)" placeholder="输入图片描述"></textarea>
            </div>
        </div>

        <div class="layui-form-item ">
            <label class="layui-form-label">轮播图</label>

            <div class="layui-input-block" >
                <button type="button" class="layui-btn" id="test2" style="float: left">
                    <i class="layui-icon">&#xe67c;</i>上传图片
                </button>
            </div>

        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">图片列表</label>
            <div class="layui-input-block" id="listimgs">
                {if condition="!empty($info.img_url)"}
                {volist name="$info.img_url" id="vo"}
                <div class="divs" onclick="updatedescrible(this)">
                    <img src="{$vo|default=''}" style="width: 100px;height: 100px">
                    <input type="hidden" value="{$vo|default=''}" name="img_url[]">
                    <input type="hidden" class="describle" value="{$info['data'][$key]|default=''}" name="data[]">
                    <span onclick="delimg(this)" class="item">删除</span>
                </div>
                {/volist}
                {/if}
            </div>
        </div>




        <div  class="layui-form-item">
            <div class="layui-input-block submit_btn">
                <button class="layui-btn" lay-submit lay-filter="*">更新</button>
                <button style="display: none;" id="reset" type="reset" class=" layui-btn layui-btn-primary">重置</button>
            </div>
        </div>

</form>

<!-- /.content -->
{/block}
{block name='js'}
<script type="text/javascript">

    function changedescrible(obj) {
        var text = $(obj).val();
        $('.current .describle').val(text);
    }

    function updatedescrible(obj) {
               var text= $(obj).find('.describle').val();
               $('#describle').val(text);
               $('.divs').removeClass('current');
               $(obj).addClass('current');
    }

    function delimg(obj) {

        if($(obj).parent().hasClass('current')){
            console.log(1231);
            $('textarea').val('222222222222');
        }
        $(obj).parent().remove();
    }
    $(function () {
        var options = {
            type: 'post',           //post提交
            //url:'http://ask.tongzhuo100.com/server/****.php?='+Math.random(),   //url
            dataType: "json",        //json格式
            data: {},    //如果需要提交附加参数，视情况添加
            clearForm: false,        //成功提交后，清除所有表单元素的值
            resetForm: false,        //成功提交后，重置所有表单元素的值
            cache: false,
            async: false,          //同步返回
            success: function (data) {
                if (data.code == 0) {
                    layer.msg(data.msg);
                } else {
                    layer.msg(data.msg, {icon: 1, time: 500}, function () {
                        $("#reset").click();
                        lotus_close();
                        parent.location.reload();
                    });
                }
                //服务器端返回处理逻辑
            },
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                layer.msg('操作失败:服务器处理失败');
            }
        };
        layui.use('form', function () {
            var form = layui.form;
            $('#mainForm').ajaxForm(options).submit(function (data) {
            });
        });
        layui.use('upload', function () {
            var upload = layui.upload;

            var url2 = "{:url('company/uploadfile')}"
            //执行实例
            var uploadInst = upload.render({
                elem: '#test2' //绑定元素
                , url: url2 //上传接口
                , field: 'image'
                , multiple: true
                , done: function (res) {
                    //上传完毕回调
//                    console.log(7777);
//                    console.log(res);
                    var html = '<div class="divs" onclick="updatedescrible(this)">' +
                        '<img src="' + res.data + '" style="width: 100px;height: 100px">' +
                        '<input type="hidden" value="' + res.data + '" name="img_url[]" >' +
                        '<input type="hidden" class="describle" value="" name="data[]">' +
                        '<span onclick="delimg(this)" class="item">删除</span>' +
                        '</div>';
                    $('#listimgs').append(html);
                    var length = $('.divs').length;
                    $('#describle').val(' ');
                    $('.divs').removeClass('current');
                    $('.divs:last').addClass('current');
                }
                , error: function () {
                    //请求异常回调
                }
            });

        });

    })



</script>
{/block}



