{extend name='public/modal'}
{block name='content'}
<script src="__STATIC__/ueditor/ueditor.config.js" type="text/javascript"></script>
<script src="__STATIC__/ueditor/ueditor.all.min.js" type="text/javascript"></script>
<script src="/static/module/layui/layui.js"></script>
<style>
    .item_header {
        width: 200px;
        height: 150px;
        border: 1px solid;
        padding: 5px
    }

    .item_item1 {
        width: 200px;
        height: 80px;
        border: 1px solid;
        padding: 5px
    }

    .item_header_text {
        display: block;
        height: 20px;
        background-color: #bbb;
        top: -40px;
        position: relative;
        color: white;
        padding: 10px 0;
    }

    .item_header_img {
        width: 100%;
        height: 150px;
    }

    .item_item1_title {
        float: left;
        width: 100px
    }

    .item_item1_img {
        float: right;
    }

    .item_item1_img img {
        width: 100px;
        height: 50px;
    }

    .item_item2 {
        text-align: center;
        line-height: 60px;
        font-size: 22pt;
        color: blue;
        cursor: pointer;

    }

    .item_checked {
        border: 3px solid red;
    }

    .del_item {
        position: relative;
        right: -150px;
        top: 40px;
        padding: 5px 10px;
        background-color: black;
        color: white;
        cursor: pointer;
    }


</style>
<form id="mainForm" class="layui-form layui-form-pane" onsubmit="return addarticle()" method='post' action="update_article_image">

    <!--<div class="layui-form-item">-->
        <!--<label class="layui-form-label">排序值</label>-->
        <!--<div class="layui-input-block">-->
            <!--<input type="text" onchange="changeelement('sort',this)" name="sort" value="5" placeholder="请输入排序值（越大越靠前）"-->
                   <!--autocomplete="off" class="layui-input">-->
        <!--</div>-->
    <!--</div>-->

    <input type="hidden" value="{$info.id}" name="id" id="media_item_id">
    <div id="type2" >
        <div class="layui-form-item type2">
            <label class="layui-form-label">标题</label>
            <div class="layui-input-block">
                <input type="text" name="title" value="{$info.title|default=''}" onchange="changeelement('title',this)" placeholder="请输入菜单名称"
                       autocomplete="off" class="layui-input">
            </div>
        </div>



        <div class="layui-form-item type2">
            <label class="layui-form-label">封面图</label>
            <div class="layui-input-block" >
                <button type="button" class="layui-btn" id="test2" style="float: left">
                    <i class="layui-icon">&#xe67c;</i>上传图片
                </button>
                <input name="cover" type="hidden" value="{$info.cover|default=''}">
                <img id="img_list" src="{$info.cover|default=''}" style="width: 100px;height: 100px;">
            </div>

        </div>

        <div class="layui-form-item type2">
            <label class="layui-form-label">摘要</label>
            <div class="layui-input-block">
                <textarea class="layui-textarea" id="summary" onchange="changeelement('summary',this)" placeholder="输入简介">{$info.summary|default=''}</textarea>
            </div>
        </div>

        <div class="layui-form-item layui-form-text type2">
            <label for="desc" class="layui-form-label">
                正文
            </label>
            <textarea placeholder="请输入内容" id="editor" style="height: 500px;" name="content" class="layui-textarea"> {$info.content|default=''}</textarea>
        </div>
    </div>


    <div class="" class="layui-form-item">
        <div class="layui-input-block submit_btn">
            <button class="layui-btn" lay-submit='' lay-filter="formDemo">提交</button>
            <button style="display: none;" type="reset" class=" layui-btn layui-btn-primary">重置</button>
        </div>
    </div>

</form>


{/block}
{block name='js'}
<script type="text/javascript">

    function addarticle() {
        var types=2
        var content='';
        var check_item=true;
        if(types==1){  //文本消息
            content =$('#message_text').val();
        }
        if(types==2){  //单图文信息发布
            var title=$("input[name='title']").val();
            if(title==""){
                layer.msg('标题不能为空');
                return false;
            }

            var cover=$("input[name='cover']").val();
            if(cover==""){
                layer.msg('封面图不能为空');
                return false;
            }

            var sumary=$("#summary").val();
            if(sumary==""){
                layer.msg('摘要不能为空');
                return false;
            }

            var text=UE.getEditor('editor').getContent();
            if(text==""){
                layer.msg('内容不能为空');
                return false;
            }
            var content=title+','+sumary+','+text+','+cover;
        }

        if( check_item==false){
            return false;
        }
        var id=$('#media_item_id').val();
        var url="{:url('update_article_image')}";
        $.ajax({
            type:'post',
            url:url,
            dataType:'json',
            data:{'data':content,'types':types,'id':id},
            success:function (res) {
                if(res.code==1){
                    layer.msg(res.msg, {icon: 1, time: 500}, function () {
                        $("#reset").click();
                        lotus_close();
                        parent.location.reload();
                    });
                }
            },
            before:function () {
                console.log('正在上传')
            }
        })
        return false;
    }

    var ue = UE.getEditor('editor');
    UE.getEditor('editor').addListener("selectionchange", function () {
        changeelement('content');
    });
    $(function () {
        var options = {
            type: 'post',           //post提交
            //url:'http://ask.tongzhuo100.com/server/****.php?='+Math.random(),   //url
            dataType: "json",        //json格式
            data: {},    //如果需要提交附加参数，视情况添加
            clearForm: false,        //成功提交后，清除所有表单元素的值
            resetForm: false,        //成功提交后，重置所有表单元素的值
            cache: false,
            async: false,          //同步返回
            success: function (data) {
                if (data.code == 0) {
                    layer.msg(data.msg);
                } else {
                    layer.msg(data.msg, {icon: 1, time: 500}, function () {
                        $("#reset").click();
                        lotus_close();
                        parent.location.reload();
                    });
                }
                //服务器端返回处理逻辑
            },
            error: function (XmlHttpRequest, textStatus, errorThrown) {
                layer.msg('操作失败:服务器处理失败');
            }
        };

        var url2="{:url('company/uploadfile')}"
        layui.use('upload', function () {
            var upload = layui.upload;
            //执行实例
            var uploadInst = upload.render({
                elem: '#test2' //绑定元素
                , url: url2 //上传接口
                , field: 'image'
                , multiple: true
                , done: function (res) {
                    var types=2
                    var img_src=res.data;
                    if(types==2){
                        $("input[name='cover']").val(img_src);
                        $('#img_list').attr('src',img_src);
                        $('#img_list').show();

                    }

                }
                , error: function () {
                    //请求异常回调
                }
            });
        })


    })
    // });
</script>
{/block}